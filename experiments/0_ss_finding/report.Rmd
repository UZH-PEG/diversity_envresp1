---
title: "SS finding report"
author: "Owen Petchey"
date: "11/25/2021"
output: html_document
---



```{r}
library(microxanox)
library(tidyverse)

source(here("R/various_useful_functions.r"))

ss_9s <- readRDS(here("experiments/0_ss_finding/data/9_strain_SS_data.RDS"))
stab_9s <- readRDS(here("experiments/0_ss_finding/data/9_strain_stab_data.RDS"))

```


```{r}
plot_ss_result3(ss_9s, 1)
plot_ss_result3(ss_9s, 2)
plot_ss_result4(ss_9s, 1, 2)
```


```{r}
## Test plot stability


CB_vars <- unique(stab_9s$CB_var_gmax_s)
SB_vars <- unique(stab_9s$SB_var_gmax_s)

CB_stab_9s <- stab_9s %>%
  filter(SB_var_gmax_s == 0) %>%
  mutate(var_treat = "CB",
         var_gmax = CB_var_gmax_s)

SBPB_stab_9s <- stab_9s %>%
  filter(CB_var_gmax_s == 0) %>%
  mutate(var_treat = "SB-PB",
         var_gmax = SB_var_gmax_s)

for_join <- tibble(CB_var_gmax_s = sort(CB_vars),
                   SB_var_gmax_s = sort(SB_vars))
CBSBPB_stab_9s <- stab_9s %>%
  right_join(for_join) %>%
  mutate(var_treat = "CB-SB-PB",
         var_gmax = CB_var_gmax_s)

all_stab_results <- CB_stab_9s %>%
  bind_rows(SBPB_stab_9s) %>%
  #  bind_rows(results3) %>%
  # bind_rows(results4) %>%
  bind_rows(CBSBPB_stab_9s)

all_stab_results <- all_stab_results %>%
  mutate(var_treat = forcats::fct_relevel(var_treat, levels = c("CB", "SB-PB", "CB-SB-PB")))
```


```{r}
all_stab_results %>%
  filter(Species == "O") %>%
  ggplot(aes(x = var_gmax, y = hyst_range_log, col=var_treat)) +
  geom_point() +
  xlab("Amount of trait variation\n[see text for units]") +
  ylab("Extent of bistability region\n[log10 oxygen diffusivity]") +
  labs(col = "Variation in\nonly these\nfunctional groups")
##ggsave("manuscript/figures/extent_of_bistab1.pdf", height = 4)
```


```{r}
all_stab_results %>%
  #filter(var_treat == "CB") %>%
  filter(Species == "O") %>%
  ggplot(aes(x = var_gmax,
             ymin = hyst_min_log,
             ymax = hyst_max_log,
             fill=var_treat)) +
  geom_ribbon(alpha = 0.5) +
  facet_wrap( ~ var_treat, nrow = 3) +
  xlab("Amount of trait variation\n[see text for units]") +
  ylab("Oxygen diffusivity\n[log10 uM per hour]") +
  labs(fill = "Variation in\nonly these\nfunctional groups") +
  coord_flip() +
  theme(
    strip.background = element_blank(),
    strip.text.x = element_blank()
  )

```

